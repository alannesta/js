<html5>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Debounce</title>
	<script src="script/jquery-1.8.3.js"></script>
</head>

<body>
	<script>
	
	var service = (function(){
		var queue = [];
		var oldlength = 0, newlength;
		var interval;

		function checkQueue(){
			return setInterval(function(){
				if ((newlength = queue.length) !== oldlength){
					queue.pop()();
					queue = [];
					clearInterval(interval);
					interval = null;
				}
			}, 500);
		}

		interval = checkQueue();
		console.log(interval);
		return {
			debounce: function(callback){
				return function(){
					if (interval){
						// console.log('setInterval already runnung');
						// console.log(interval);
					}else{
						// console.log('start interval');
						interval = checkQueue();
					}
					console.log('debounce!!!!')
					queue.push(callback);
				}
			}
		}

	})();

	var debounce = service.debounce(function(){
		console.log('resize');
	});

	$(window).on('resize', debounce);


	
	// underscore implementation

	_.debounce = function(func) {
	  var timeout, args, context, timestamp, result;

	  var later = function() {
	    var last = _.now() - timestamp;

	    if (last >= 0) {
	      timeout = setTimeout(later, last);
	    } else {
	      	timeout = null;
	        result = func.apply(context, args);
	        if (!timeout) context = args = null;
	      }
	    }
	  };

	  return function() {
	    context = this;
	    args = arguments;
	    timestamp = _.now();
	    if (!timeout) timeout = setTimeout(later, 0);
	  };
	};



  </script>
</body>
</html>




